\documentclass[14pt]{extarticle}

\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{hyphenat}

%\usepackage{mathptmx}
\usepackage{gensymb}
\usepackage[left = \flqq{},right = \frqq{}]{dirtytalk}

\usepackage{amsmath}

\usepackage{geometry}
\geometry{
	a4paper,
	top=20mm,
	bottom=23mm,
	footskip=10mm,
	left=25mm,
	right=15mm
}
\setlength{\parindent}{10mm}
\renewcommand{\baselinestretch}{1.5}

\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\lhead{}
\chead{}
\rhead{}
\lfoot{}
\cfoot{}
\rfoot{\thepage}

\usepackage{indentfirst}

\usepackage{enumitem}

\usepackage{graphicx}
\usepackage[labelformat=simple]{subcaption}
\renewcommand{\thesubfigure}{\textit{\asbuk{subfigure})}}
\usepackage{setspace}
\usepackage[font=small, labelsep=period]{caption}
\captionsetup[figure]{font={small,stretch=1.0}}

\usepackage{titlesec}
\titleformat{\section}[hang]{\large\bf}{\thesection.}{.5em}{}{}
\titleformat{\subsection}[hang]{\normalsize\bf}{\thesubsection.}{.5em}{}{}
\titleformat{\subsubsection}[hang]{\normalsize\bf}{\thesubsubsection.}{.5em}{}{}
\titlespacing*{\section}{0mm}{6pt}{6pt}
\titlespacing*{\subsection}{0mm}{6pt}{6pt}
\titlespacing*{\subsubsection}{0mm}{6pt}{6pt}

\usepackage{titletoc}
\titlecontents{section}[3mm]{}{\thecontentslabel.\space\filright}{}{\titlerule*[1pc]{.}\contentspage}
\titlecontents{subsection}[6mm]{}{\thecontentslabel.\space\filright}{}{\titlerule*[1pc]{.}\contentspage}
\titlecontents{subsubsection}[9mm]{}{\thecontentslabel.\space\filright}{}{\titlerule*[1pc]{.}\contentspage}

\usepackage{enumitem}
\setlist{nosep}

\begin{document}
	\setlength{\abovedisplayskip}{6pt}
	\setlength{\belowdisplayskip}{6pt}
	\setlength{\belowcaptionskip}{-15pt}
	\pagenumbering{arabic}
	\setcounter{page}{3}
	\thispagestyle{fancy}
\tableofcontents
\newpage
\section{Введение}
В Институте ядерной физики им. Г. И. Будкера СО РАН проводятся эксперименты на электрон-позитронном коллайдере ВЭПП-2000. Коллайдер имеет два места встречи пучков, в которых установлены детекторы КМД-3 (криогенный магнитный детектор) и СНД (сферический нейтральный детектор). В программу проекта ВЭПП-2000 включено измерение сечений процессов, наблюдаемых при столкновениях электронов и позитронов в диапазоне энергий до 2 ГэВ. В число изучаемых процессов входят процессы с фотонами в конечном состоянии \cite{shatunov}.

Для регистрации фотонов в детекторе КМД-3 используется жидкоксеноновый (LXe) калориметр. Фотон, попадая в калориметр, порождает электромагнитный ливень из вторичных электронов, позитронов и фотонов. Частицы ливня регистрируются сигнальными полосками, расположенными на слоях калориметра. Сработавшие сигнальные полоски группируются в кластеры.

При столкновениях электронов $e^-$ и позитронов $e^+$ большое сечение рождения имеют процессы, содержащие нейтральный пион $\pi^0$ в конечном состоянии. Одним из таких процессов является $e^- e^+ \rightarrow \pi^0 \gamma$. Нейтральный пион с вероятностью 99\% распадается на два фотона $\gamma$. Минимальный угол между фотонами при более высокой энергии пи-мезона становится меньше, и при значении $E_{\pi^0}$ = 1 ГэВ этот угол составляет 0,27 радиана. Электромагнитные ливни таких фотонов в калориметре могут перекрываться, и появляется вероятность принять два слившихся кластера, образованных двумя фотонами, за одиночный кластер от одного фотона. Чтобы увеличить статистику событий, повысить точность измерения сечения и других параметров процесса, необходимо разделять такие кластеры \cite{lakomov}.

Таким образом, требуется разработать алгоритм различения однофотонных и двухфотонных кластеров в LXe калориметре детектора КМД-3. Для решения этой задачи выполнены следующие шаги:
\begin{itemize}
	\item описание детектора КМД-3 и LXe калориметра,
	\item подготовка данных для обработки,
	\item обзор библиотеки TMVA 4 и метода BDT,
	\item анализ задачи разделения кластеров,
	\item реализация алгоритма разделения кластеров с помощью метода BDT.
\end{itemize}

Результаты данной работы планируется сравнить с результатами, полученными в работах \cite{lakomov,rabusov}.
\section{Детектор КМД-3 и LXe калориметр}
На рис.~\ref{fig:cmd3} представлена схема криогенного магнитного детектора КМД-3.
\begin{figure}[h!]
	\includegraphics[width=\linewidth]{../pics/cmd3-2.png}
	\caption{Схема детектора КМД-3: 1 -- вакуумная камера, 2 - дрейфовая камера, 3 -- торцевой BGO калориметр, 4 -- Z-камера, 5 -- сверхпроводящий соленоид, 6 -- цилиндрический жидкоксеноновый калориметр, 7 -- времяпролётная система, 8 -- цилиндрический CsI калориметр, 9 -- ярмо магнита \cite{shebalin}.}
	\label{fig:cmd3}
\end{figure}

Цилиндрический электромагнитный калориметр детектора регистрирует фотоны и электроны, которые вылетают под большими углами к оси пучков (от $39\degree$ до $141\degree$), и охватывает телесный угол $0,8 \cdot 4\pi$. Он состоит из двух соосных подсистем: жидкоксенонового LXe калориметра и кристаллического CsI калориметра.

Жидкоксеноновый калориметр образован семью соосными катодами и восемью анодами, образующими систему ионизационных камер. Структура электродов LXe калориметра представлена на рис.~\ref{fig:lxe-electrodes}.

\begin{figure}[h!]
	\includegraphics[width=\linewidth]{../pics/lxe-electrodes.png}
	\caption{Структура электродов жидкоксенонового калориметра \cite{shebalin}.}
	\label{fig:lxe-electrodes}
\end{figure}

Поверхность каждого анода разделена на 264 прямоугольные площадки -- восемь вдоль оси пучков $Z$, тридцать три в перпендикулярной ей плоскости $R,\varphi$. Площадки с одинаковым положением по $Z$ и $\varphi$ соединены проводником в \say{башню}. Такая \say{башня} ориентирована в место встречи пучков. Аноды используются для измерения выделенной энергии.

Каждый катод разбит на 2112 полосок. Полоски объединены в группы по четыре, и с каждой такой группы сигнал снимается по одному каналу. На противоположных сторонах катода полоски ориентированы взаимно перпендикулярно и находятся под углом $45\degree$ к оси пучков $Z$. Такая структура катода используется для восстановления координат кластера \cite{shebalin}.

Регистрация фотонов производится путём сбора информации о частицах электромагнитного ливня, порождённого при взаимодействии фотона с материалом калориметра. LXe калориметр позволяет измерять координаты с погрешностью от 0,7 мм для первого слоя до 1,4 мм для шестого слоя \cite{Epifanov_2011,lxe_2009}. Точность измерения энергии составляет примерно 8,5\% для нейтральных пи-мезонов \cite{Anisenkov_2014}.

\section{Формат выходных данных с полосок и их обработка}
В результате оцифровки данных с полосковой части LXe-калориметра сохраняются номер каждой сработавшей полоски и амплитуды их сигналов. После обработки собранной информации проводится реконструкция полосковых кластеров. Полосковым кластером на одном из слоев калориметра называется набор соседних полосок с одной стороны катода. Алогритм реконструкции кластеров заключается в следующем:
\begin{itemize}
    \item нахождение полосок, амплитуда сигнала которых превысила верхний порог срабатывания,
    \item к найденным затравачным полоскам присоединяются соседние полоски, амплитуда которых превысила нижний порог срабатывания.
\end{itemize}
В рамках данной работы полоски, не принадлежащие ни к одному из полосковых кластеров, не будут использоваться далее.

Получившиеся данные сохраняются в формате классов CmdLXeStripHit и CmdLXeStripCluster, которые были специально разработаны командой детектора CMD-3. В классе CmdLXeStripHit содержится такая информация как: номер полоски, номер слоя, номер полоски на слое, направление полоски, амплитуда и ошибка измерения амплитуды. Класс CmdLXeStripCluster 

\section{Библиотека TMVA и метод BDT}
Библиотека TMVA (The Toolkit for Multivariate Analysis) предоставляет среду для параллельного вычисления и применения методов многомерной классификации и, начиная с версии TMVA 4, многомерной регрессии. В данной библиотеке представлены только алгоритмы машинного обучения с учителем. Они используют тренировочные события с известным результатом, чтобы определить отображение, которое описывает либо критерии классификации, либо регрессионное приближение для функции результата. Среда TMVA разработана в основном для нужд физики высоких энергий, но может применяться и в других областях \cite{tmva4}.

В данной работе используется метод BDT (boosted decision trees), основанный на нахождении множества деревьев решений с присвоенными им весами. Дерево решений -- это классификатор, построенный в виде двоичного дерева. Пример такого дерева изображён на рис.~\ref{fig:dectree}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{../pics/decision.png}
	\caption{Пример дерева решений. Решения принимаются на основе переменных $x1$, $x2$, $x3$, критериями являются величины $c1$, $c2$, $c3$, $c4$.}
	\label{fig:dectree}
\end{figure}

Задача алгоритма, использующего дерево решений, заключается в том, чтобы пройти это дерево, начиная с корневого узла, и закончить на одном из листьев дерева. В каждом узле находится критерий выбора дочернего узла по значению одной из переменных. В результате алгоритм относит событие к категории сигнальных или фоновых.

Тренировка дерева производится поэтапно, начиная с корневого узла. Выбирается критерий, наиболее эффективно делящий события на фоновые и сигнальные, то есть дающий наибольшую долю правильно классифицированных событий в обеих категориях. Такая же процедура выбора критерия выполняется на каждом из двух образовавшихся подмножеств событий и так далее до определённой глубины дерева. Таким образом, фазовое пространство оказывается поделено на сегменты, помеченные как сигнал или фон в зависимости от того, событий какого типа больше всего попало в данный сегмент при тренировке алгоритма.

Достоинства дерева решений -- простота описания и интерпретации, а также возможность разбивать фазовое пространство на большое число гиперкубов, обозначаемых как фон или сигнал -- в отличие от анализа на основе совокупности пороговых значений, которая выделяет лишь один гиперкуб. Недостатком дерева решений является его чувствительность к статистическим флуктуациям в тренировочном наборе событий. Например, две переменные, одинаково влияющие на классификацию событий, под действием флуктуаций могут идти в разном порядке следования сравнений, что изменит и всю дальнейшую структуру дерева, в итоге воздействуя на результат классификации.

Для уменьшения флуктуаций, метод BDT использует бустинг деревьев. Для этого данные делятся на некоторое количество ансамблей $N$, и на каждом ансамбле тренируется по одному дереву решений. В итоге получается $N$ деревьев, каждое из которых имеет свой уровень разделения и даёт свой отклик на одно и то же событие. Деревьям присваиваются веса в зависимости от качества классификации. Итоговая величина $r$ отклика на событие вычисляется как средневзвешенное по всем деревьям:
\begin{align*}
r = \sum_i \omega_i r_i,
\end{align*}
где $\omega_i$ -- вес $i$-го дерева, $r_i$ -- отклик $i$-го дерева \cite{tmva4}.
\section{Алгоритм разделения кластеров}
Задача алгоритма -- классифицировать события, в которых образованный кластер включает в себя один фотон (сигнал) или два фотона (фон), то есть определить событие как сигнальное или фоновое, имея координаты совокупности точек и связанные с ними значения энергии.

Для решения этой задачи в среде C++/ROOT с использованием библиотеки TMVA 4 выполнены следующие шаги:
\begin{enumerate}
    \item реализация и проверка алгоритма разделения тестовых данных при помощи BDT,
    \item выполнена подготовка данных моделирования процесса $e^{+}\:e^{-} \to \pi^{0}\:\gamma$ для дальнейших обучения и проверки алгоритма классификации.
\end{enumerate}

Генератор тренировочного набора данных на выходе даёт заданное количество событий, имеющих три параметра: массу, рост и возраст. Каждому событию присваивается тип -- сигнальное или фоновое событие (рис.~\ref{fig:gendistr}).

\begin{figure}[h!]
	\centering
	\includegraphics[width=\linewidth]{../pics/inputdistr.png}
	\caption{Распределения входных данных. Сгенерировано 100000 событий. Переменная mass -- масса частицы, height -- амплитуда сигнала, age -- номер слоя.}
	\label{fig:gendistr}
\end{figure}

Для реализации алгоритма подключена библиотека TMVA 4, выбран метод классификации BDT. В качестве критерия разделения при тренировке дерева можно применять $GiniIndex = p(1-p)$, где $p = \frac{s}{s+b}$ -- \say{чистота} набора, $s$ и $b$ -- соответственно, число сигнальных и фоновых событий в наборе; статистическую значимость $\frac{S}{\sqrt{S+B}}$, где $S=\frac{s_+}{s}$ и $B=\frac{b_+}{b}$ -- корректность распознавания, $s_+$ и $b_+$ -- число событий, правильно распознанных как сигнал или фон; ошибку классификации $(1-\max (p,{1-p}))$ и прочие \cite{tmva4}. В реализованном алгоритме критерием разделения является минимальное значение $GiniIndex$. Максимальная глубина дерева равна трём, и для уменьшения статистических флуктуаций минимальная доля от всех событий на один узел выбрана равной 2,5\%. Во всём ансамбле 100000 событий, на них тренируются 850 деревьев.

Характеристики алгоритма после обучения представлены на рис.~\ref{fig:roc} и рис.~\ref{fig:significance}. Кривая ROC (receiver operating characteristic), сопоставляющая долю событий, отнесённых к фону, и долю распознанного сигнала, отображает качество алгоритма: лучше тот алгоритм, который при том же уровне разделения сохраняет больше всего сигнальных событий.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{../pics/ROC.png}
	\caption{Кривая ROC. По горизонтальной оси отложена эффективность по сигналу, по вертикальной оси -- эффективность по фону.}
	\label{fig:roc}
\end{figure}

Статистическая значимость $\frac{S}{\sqrt{S+B}}$ показывает, насколько правильно распознаются события при данном пороговом значении отклика. На рис.~\ref{fig:significance} изображен график значимости, а также величины корректности распознавания сигнала $S$ и фона $B$. По максимальному значению значимости определено оптимальное значение порога -0,02.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{../pics/significance.png}
	\caption{График статистической значимости. Вертикальной линией обозначен выбранный критерий деления событий.}
	\label{fig:significance}
\end{figure}

\section{Результаты}

Полученные в результате обучения алгоритма деревья были применены к другому набору тестовых данных, сгенерированных тем же способом, что и тренировочный набор. В результате события классифицировались на сигнальные и фоновые. Сравнение результатов классификации с изначально заданными типами событий представлено гистограммой на рис.~\ref{fig:verification}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{../pics/verification2.png}
	\caption{Распределение отклика BDT на проверочный набор событий. Синим цветом обозначен сигнал, красным -- фон. Вертикальной чёрной линией выделен порог отклика. Если отклик на событие ниже порога, оно распознаётся как фоновое, иначе -- как сигнальное.}
	\label{fig:verification}
\end{figure}

Из всех событий 50,4\% классифицировались как сигнал, из них 85,3\% правильно, а остальные 14,7\% на самом деле являлись фоновыми. Из 49,6\% распознанных фоновых событий действительно фоновыми были 86,1\%, а ос-тальные 13,9\% при генерации задавались как сигнал. В итоге доля ложных распознаваний среди всех событий составляет 14,3\%.

Таким образом, метод BDT является перспективным инструментом в разработке алгоритмов разделения кластеров, так как в этой задаче требуется анализ по многим переменным, а данный метод заточен на многомерную классификацию событий.
\section{Заключение}
В данной работе произведён анализ задачи разделения кластеров в электромагнитном жидкоксеноновом калориметре криогенного магнитного детектора КМД-3. На основе метода BDT, реализованного в библиотеке TMVA 4, разработан алгоритм классификации событий, в которых кластер порождён одним или двумя фотонами. Проведена проверка работы алгоритма на тестовом наборе данных, и выявлена доля ложных распознаваний.

Достоинствами метода BDT являются возможность выделить много сегментов фазового пространства путём создания деревьев решений и уменьшить статистические флуктуации отклика при помощи бустинга. В дальнейшем планируется развить алгоритм классификации событий, а также реализовать методику реконструкции перекрывающихся кластеров с целью восстанавливать исходные кластеры.

\bibliographystyle{unsrt}
\addcontentsline{toc}{section}{Список литературы}
\bibliography{coursework}
\end{document}